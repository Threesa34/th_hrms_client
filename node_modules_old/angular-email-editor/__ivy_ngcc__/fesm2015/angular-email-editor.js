import { Injectable, Component, Input, Output, EventEmitter, NgModule, defineInjectable } from '@angular/core';

import * as ɵngcc0 from '@angular/core';
class EmailEditorService {
    constructor() { }
}
EmailEditorService.ɵfac = function EmailEditorService_Factory(t) { return new (t || EmailEditorService)(); };
EmailEditorService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: EmailEditorService, factory: EmailEditorService.ɵfac, providedIn: 'root' });
/** @nocollapse */
EmailEditorService.ctorParameters = () => [];
EmailEditorService.ngInjectableDef = defineInjectable({ factory: function EmailEditorService_Factory() { return new EmailEditorService(); }, token: EmailEditorService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(EmailEditorService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return []; }, null); })();

const scriptUrl = '//editor.unlayer.com/embed.js?2';
const callbacks = [];
let loaded = false;
const isScriptInjected = () => {
    const scripts = document.querySelectorAll('script');
    let injected = false;
    scripts.forEach((script) => {
        if (script.src.includes(scriptUrl)) {
            injected = true;
        }
    });
    return injected;
};
const addCallback = (callback) => {
    callbacks.push(callback);
};
const runCallbacks = () => {
    if (loaded) {
        let callback;
        while ((callback = callbacks.shift())) {
            callback();
        }
    }
};
const loadScript = (callback) => {
    addCallback(callback);
    if (!isScriptInjected()) {
        const embedScript = document.createElement('script');
        embedScript.setAttribute('src', scriptUrl);
        embedScript.onload = () => {
            loaded = true;
            runCallbacks();
        };
        document.head.appendChild(embedScript);
    }
    else {
        runCallbacks();
    }
};

var name = "angular-email-editor";
var version = "0.7.1";
var peerDependencies = {
	"@angular/common": "^7.0.0",
	"@angular/core": "^7.0.0"
};
var pkg = {
	name: name,
	version: version,
	peerDependencies: peerDependencies
};

let lastEditorId = 0;
class EmailEditorComponent {
    constructor() {
        this.options = {};
        this.minHeight = '500px';
        this.loaded = new EventEmitter();
        this.editorId = `editor-${++lastEditorId}`;
    }
    ngOnInit() { }
    ngAfterViewInit() {
        loadScript(this.loadEditor.bind(this));
    }
    loadEditor() {
        const options = this.options || {};
        if (this.projectId) {
            options.projectId = this.projectId;
        }
        if (this.tools) {
            options.tools = this.tools;
        }
        if (this.appearance) {
            options.appearance = this.appearance;
        }
        if (this.locale) {
            options.locale = this.locale;
        }
        this.editor = unlayer.createEditor(Object.assign({}, options, { id: this.editorId, displayMode: 'email', source: {
                name: pkg.name,
                version: pkg.version,
            } }));
        this.loaded.emit({});
    }
    loadDesign(data) {
        this.editor.loadDesign(data);
    }
    saveDesign(cb) {
        this.editor.saveDesign(cb);
    }
    exportHtml(cb) {
        this.editor.exportHtml(cb);
    }
}
EmailEditorComponent.ɵfac = function EmailEditorComponent_Factory(t) { return new (t || EmailEditorComponent)(); };
EmailEditorComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: EmailEditorComponent, selectors: [["email-editor"]], inputs: { options: "options", minHeight: "minHeight", editorId: "editorId", projectId: "projectId", tools: "tools", appearance: "appearance", locale: "locale" }, outputs: { loaded: "loaded" }, decls: 1, vars: 3, consts: [[1, "unlayer-editor", 3, "id"]], template: function EmailEditorComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("min-height", ctx.minHeight);
        ɵngcc0.ɵɵproperty("id", ctx.editorId);
    } }, styles: ["[_nghost-%COMP%]{flex:1;display:flex}.unlayer-editor[_ngcontent-%COMP%]{flex:1;display:flex}"] });
/** @nocollapse */
EmailEditorComponent.ctorParameters = () => [];
EmailEditorComponent.propDecorators = {
    editorId: [{ type: Input }],
    options: [{ type: Input }],
    projectId: [{ type: Input }],
    tools: [{ type: Input }],
    appearance: [{ type: Input }],
    locale: [{ type: Input }],
    minHeight: [{ type: Input }],
    loaded: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(EmailEditorComponent, [{
        type: Component,
        args: [{
                // tslint:disable-next-line:component-selector
                selector: 'email-editor',
                template: "<div [id]=\"editorId\" class=\"unlayer-editor\" [style.min-height]=\"minHeight\"></div>",
                styles: [":host{flex:1;display:flex}.unlayer-editor{flex:1;display:flex}"]
            }]
    }], function () { return []; }, { options: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], loaded: [{
            type: Output
        }], editorId: [{
            type: Input
        }], projectId: [{
            type: Input
        }], tools: [{
            type: Input
        }], appearance: [{
            type: Input
        }], locale: [{
            type: Input
        }] }); })();

class EmailEditorModule {
}
EmailEditorModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: EmailEditorModule });
EmailEditorModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function EmailEditorModule_Factory(t) { return new (t || EmailEditorModule)(); }, imports: [[]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(EmailEditorModule, { declarations: [EmailEditorComponent], exports: [EmailEditorComponent] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(EmailEditorModule, [{
        type: NgModule,
        args: [{
                declarations: [EmailEditorComponent],
                imports: [],
                exports: [EmailEditorComponent]
            }]
    }], null, null); })();

/*
 * Public API Surface of email-editor
 */

/**
 * Generated bundle index. Do not edit.
 */

export { EmailEditorService, EmailEditorComponent, EmailEditorModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1lbWFpbC1lZGl0b3IuanMiLCJzb3VyY2VzIjpbIm5nOi9hbmd1bGFyLWVtYWlsLWVkaXRvci9saWIvZW1haWwtZWRpdG9yLnNlcnZpY2UudHMiLCJuZzovYW5ndWxhci1lbWFpbC1lZGl0b3IvbGliL2xvYWRTY3JpcHQudHMiLCJuZzovYW5ndWxhci1lbWFpbC1lZGl0b3IvbGliL2VtYWlsLWVkaXRvci5jb21wb25lbnQudHMiLCJuZzovYW5ndWxhci1lbWFpbC1lZGl0b3IvbGliL2VtYWlsLWVkaXRvci5tb2R1bGUudHMiLCJuZzovYW5ndWxhci1lbWFpbC1lZGl0b3IvcHVibGljX2FwaS50cyIsIm5nOi9hbmd1bGFyLWVtYWlsLWVkaXRvci9hbmd1bGFyLWVtYWlsLWVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7TUFLYSxrQkFBa0I7QUFDL0IsSUFDRSxpQkFBaUI7QUFDbkI7OENBTkMsVUFBVSxTQUFDLGtCQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLHFJQUNJO0FBQUM7QUFBbUI7QUFJWDs7Ozs7O2dEQUE4TDtBQUFDO0FDVDdNLE1BQU0sU0FBUyxHQUFHLGlDQUFpQyxDQUFDO0FBQ3BELE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUNyQixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7QUFFbkIsTUFBTSxnQkFBZ0IsR0FBRztBQUN6QixJQUFFLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN0RCxJQUFFLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztBQUN2QixJQUNFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNO0FBQ3pCLFFBQUksSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRTtBQUN4QyxZQUFNLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDdEIsU0FBSztBQUNMLEtBQUcsQ0FBQyxDQUFDO0FBQ0wsSUFDRSxPQUFP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QUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFDSkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQzFCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFRQSxBQUFBLEFBQUEsQUFlQSxBQVpBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFNQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFLQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBekVBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBR0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUVBLEFBQUEsQUM3QkEsQUFBQSxBQU5BLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUNSQSxBQUVBLEFDRkEsQUFFQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgRW1haWxFZGl0b3JTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3RvcigpIHsgfVxufVxuIiwiY29uc3Qgc2NyaXB0VXJsID0gJy8vZWRpdG9yLnVubGF5ZXIuY29tL2VtYmVkLmpzPzInO1xuY29uc3QgY2FsbGJhY2tzID0gW107XG5sZXQgbG9hZGVkID0gZmFsc2U7XG5cbmNvbnN0IGlzU2NyaXB0SW5qZWN0ZWQgPSAoKSA9PiB7XG4gIGNvbnN0IHNjcmlwdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKTtcbiAgbGV0IGluamVjdGVkID0gZmFsc2U7XG5cbiAgc2NyaXB0cy5mb3JFYWNoKChzY3JpcHQpID0+IHtcbiAgICBpZiAoc2NyaXB0LnNyYy5pbmNsdWRlcyhzY3JpcHRVcmwpKSB7XG4gICAgICBpbmplY3RlZCA9IHRydWU7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gaW5qZWN0ZWQ7XG59O1xuXG5jb25zdCBhZGRDYWxsYmFjayA9IChjYWxsYmFjaykgPT4ge1xuICBjYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG59O1xuXG5jb25zdCBydW5DYWxsYmFja3MgPSAoKSA9PiB7XG4gIGlmIChsb2FkZWQpIHtcbiAgICBsZXQgY2FsbGJhY2s7XG5cbiAgICB3aGlsZSAoKGNhbGxiYWNrID0gY2FsbGJhY2tzLnNoaWZ0KCkpKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGxvYWRTY3JpcHQgPSAoY2FsbGJhY2spID0+IHtcbiAgYWRkQ2FsbGJhY2soY2FsbGJhY2spO1xuXG4gIGlmICghaXNTY3JpcHRJbmplY3RlZCgpKSB7XG4gICAgY29uc3QgZW1iZWRTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBlbWJlZFNjcmlwdC5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNjcmlwdFVybCk7XG4gICAgZW1iZWRTY3JpcHQub25sb2FkID0gKCkgPT4ge1xuICAgICAgbG9hZGVkID0gdHJ1ZTtcbiAgICAgIHJ1bkNhbGxiYWNrcygpO1xuICAgIH07XG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChlbWJlZFNjcmlwdCk7XG4gIH0gZWxzZSB7XG4gICAgcnVuQ2FsbGJhY2tzKCk7XG4gIH1cbn07XG4iLCJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBsb2FkU2NyaXB0IH0gZnJvbSAnLi9sb2FkU2NyaXB0JztcbmltcG9ydCBwa2cgZnJvbSAnLi9zb3VyY2UuanNvbic7XG5cbmRlY2xhcmUgbW9kdWxlIHVubGF5ZXIge1xuICBmdW5jdGlvbiBpbml0KG9iamVjdCk7XG4gIGZ1bmN0aW9uIGNyZWF0ZUVkaXRvcihvYmplY3QpO1xuICBmdW5jdGlvbiBsb2FkRGVzaWduKG9iamVjdCk7XG4gIGZ1bmN0aW9uIHNhdmVEZXNpZ24oRnVuY3Rpb24pO1xuICBmdW5jdGlvbiBleHBvcnRIdG1sKEZ1bmN0aW9uKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVbmxheWVyT3B0aW9ucyB7XG4gIHByb2plY3RJZD86IG51bWJlcjtcbiAgdG9vbHM/OiBvYmplY3Q7XG4gIGFwcGVhcmFuY2U/OiBvYmplY3Q7XG4gIGxvY2FsZT86IHN0cmluZztcbn1cblxubGV0IGxhc3RFZGl0b3JJZCA9IDA7XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnZW1haWwtZWRpdG9yJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2VtYWlsLWVkaXRvci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2VtYWlsLWVkaXRvci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRW1haWxFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xuXG4gIEBJbnB1dCgpIGVkaXRvcklkOiBzdHJpbmc7XG4gIEBJbnB1dCgpIG9wdGlvbnM6IFVubGF5ZXJPcHRpb25zID0ge307XG4gIEBJbnB1dCgpIHByb2plY3RJZDogbnVtYmVyO1xuICBASW5wdXQoKSB0b29sczogb2JqZWN0O1xuICBASW5wdXQoKSBhcHBlYXJhbmNlOiBvYmplY3Q7XG4gIEBJbnB1dCgpIGxvY2FsZTogc3RyaW5nO1xuXG4gIEBJbnB1dCgpIG1pbkhlaWdodCA9ICc1MDBweCc7XG5cbiAgQE91dHB1dCgpIGxvYWRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBlZGl0b3I6IGFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmVkaXRvcklkID0gYGVkaXRvci0keysrbGFzdEVkaXRvcklkfWA7XG4gICB9XG5cbiAgbmdPbkluaXQoKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBsb2FkU2NyaXB0KHRoaXMubG9hZEVkaXRvci5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBsb2FkRWRpdG9yKCkge1xuICAgIGNvbnN0IG9wdGlvbnM6IFVubGF5ZXJPcHRpb25zID0gdGhpcy5vcHRpb25zIHx8IHt9O1xuXG4gICAgaWYgKHRoaXMucHJvamVjdElkKSB7XG4gICAgICBvcHRpb25zLnByb2plY3RJZCA9IHRoaXMucHJvamVjdElkO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRvb2xzKSB7XG4gICAgICBvcHRpb25zLnRvb2xzID0gdGhpcy50b29scztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcHBlYXJhbmNlKSB7XG4gICAgICBvcHRpb25zLmFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubG9jYWxlKSB7XG4gICAgICBvcHRpb25zLmxvY2FsZSA9IHRoaXMubG9jYWxlO1xuICAgIH1cblxuICAgIHRoaXMuZWRpdG9yID0gdW5sYXllci5jcmVhdGVFZGl0b3Ioe1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIGlkOiB0aGlzLmVkaXRvcklkLFxuICAgICAgZGlzcGxheU1vZGU6ICdlbWFpbCcsXG4gICAgICBzb3VyY2U6IHtcbiAgICAgICAgbmFtZTogcGtnLm5hbWUsXG4gICAgICAgIHZlcnNpb246IHBrZy52ZXJzaW9uLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMubG9hZGVkLmVtaXQoe30pO1xuICB9XG5cbiAgcHVibGljIGxvYWREZXNpZ24oZGF0YTogb2JqZWN0KSB7XG4gICAgdGhpcy5lZGl0b3IubG9hZERlc2lnbihkYXRhKTtcbiAgfVxuXG4gIHB1YmxpYyBzYXZlRGVzaWduKGNiOiAoZGF0YTogb2JqZWN0KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5lZGl0b3Iuc2F2ZURlc2lnbihjYik7XG4gIH1cblxuICBwdWJsaWMgZXhwb3J0SHRtbChjYjogKGRhdGE6IG9iamVjdCkgPT4gdm9pZCkge1xuICAgIHRoaXMuZWRpdG9yLmV4cG9ydEh0bWwoY2IpO1xuICB9XG5cbn1cbiIsImltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBFbWFpbEVkaXRvckNvbXBvbmVudCB9IGZyb20gJy4vZW1haWwtZWRpdG9yLmNvbXBvbmVudCc7XG5cbkBOZ01vZHVsZSh7XG4gIGRlY2xhcmF0aW9uczogW0VtYWlsRWRpdG9yQ29tcG9uZW50XSxcbiAgaW1wb3J0czogW1xuICBdLFxuICBleHBvcnRzOiBbRW1haWxFZGl0b3JDb21wb25lbnRdXG59KVxuZXhwb3J0IGNsYXNzIEVtYWlsRWRpdG9yTW9kdWxlIHsgfVxuIiwiLypcbiAqIFB1YmxpYyBBUEkgU3VyZmFjZSBvZiBlbWFpbC1lZGl0b3JcbiAqL1xuXG5leHBvcnQgKiBmcm9tICcuL2xpYi9lbWFpbC1lZGl0b3Iuc2VydmljZSc7XG5leHBvcnQgKiBmcm9tICcuL2xpYi9lbWFpbC1lZGl0b3IuY29tcG9uZW50JztcbmV4cG9ydCAqIGZyb20gJy4vbGliL2VtYWlsLWVkaXRvci5tb2R1bGUnO1xuIiwiLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgKiBmcm9tICcuL3B1YmxpY19hcGknO1xuIl19